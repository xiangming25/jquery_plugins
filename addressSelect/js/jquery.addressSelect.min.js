(function($){$.fn.addressSelect=function(opt){var $this=$(this),$province=$this.find("#province"),$city=$this.find("#city"),$district=$this.find("#district"),defaultProvinceStr='<option value="">--请选择省--</option>',provinceStr=defaultProvinceStr,defaultCityStr='<option value="">--请选择市--</option>',cityStr=defaultCityStr,defaultDistrictStr='<option value="">--请选择区--</option>',districtStr=defaultDistrictStr,addressJson=null;init();function init(){$province.html(defaultProvinceStr);$city.html(defaultCityStr);$district.html(defaultDistrictStr);getAddressJson();$province.on("change",renderCity);$city.on("change",renderDistrict)}function getAddressJson(){$.getJSON("address.json",function(data){addressJson=data;renderProvince()})}function renderProvince(){addressJson.forEach(function(addressItem,index){provinceStr+='<option value="'+addressItem.id+'">'+addressItem.name+"</option>"});$province.html(provinceStr)}function renderCity(){var provinceId=$province.val(),cityStr=defaultCityStr,districtStr=defaultDistrictStr,cityArr=[];addressJson.forEach(function(addressItem,index){if(addressItem.id===provinceId){cityArr=addressItem.sub;return}});cityArr.forEach(function(cityItem,index){cityStr+='<option value="'+cityItem.id+'">'+cityItem.name+"</option>"});$city.html(cityStr);$district.html(districtStr)}function renderDistrict(){var provinceId=$province.val(),cityId=$city.val(),districtStr=defaultDistrictStr,cityArr=[],districtArr=[];addressJson.forEach(function(addressItem,index){if(addressItem.id===provinceId){cityArr=addressItem.sub;return}});cityArr.forEach(function(cityItem){if(cityItem.id===cityId){districtArr=cityItem.sub;return}});districtArr.forEach(function(districtItem){districtStr+='<option value="'+districtItem.id+'">'+districtItem.name+"</option>"});$district.html(districtStr)}return this}})(jQuery);
